{% extends "base.html" %}

{% block title %}Register - Aneurysm Detection{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h1>Create Account</h1>

        <form id="register-form" class="auth-form">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required
                       pattern="[a-zA-Z0-9_]+" minlength="3" maxlength="50"
                       placeholder="Choose a username">
                <small>Letters, numbers, and underscores only</small>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required
                       placeholder="your@email.com">
            </div>

            <div class="form-group">
                <label for="full_name">Full Name (optional)</label>
                <input type="text" id="full_name" name="full_name"
                       placeholder="Your full name">
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required
                       minlength="8" placeholder="Choose a strong password">
                <small>At least 8 characters with uppercase, lowercase, and numbers</small>
            </div>

            <div id="result"></div>

            <button type="submit" class="btn btn-primary">Create Account</button>
        </form>

        <p class="auth-link">
            Already have an account? <a href="/login">Login here</a>
        </p>
    </div>
</div>

<script>
document.getElementById('register-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p>Creating account...</p>';

    const data = {
        username: document.getElementById('username').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        full_name: document.getElementById('full_name').value || null
    };

    try {
        const response = await fetch('/auth/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {
            resultDiv.innerHTML = '<p class="success">Account created successfully! Redirecting to login...</p>';
            setTimeout(() => {
                window.location.href = '/login';
            }, 1500);
        } else {
            resultDiv.innerHTML = '<p class="error">Error: ' + (result.detail || 'Registration failed') + '</p>';
        }
    } catch (error) {
        resultDiv.innerHTML = '<p class="error">Error: ' + error.message + '</p>';
    }
});
</script>

<style>
.success {
    color: #27ae60;
    padding: 0.5rem;
    background: #e8f5e9;
    border-radius: 4px;
}
</style>
{% endblock %}
